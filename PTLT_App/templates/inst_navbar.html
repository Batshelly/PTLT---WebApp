{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>PTLT - Instructor Dashboard</title>
    <link rel="icon" type="image/png" href="{% static 'image/ptlt_webapp.png' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>

<!-- Instructor Top Navigation Bar -->
<div class="nav_top mb-3">
  <div class="container-fluid">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 py-2">
      <div class="d-flex flex-column flex-md-row align-items-start align-items-md-center nav_links gap-2 gap-md-0">
        <strong class="pe-md-3 me-md-3 fs-5 ptlt">PTLT</strong>
        <a href="{% url 'instructor_schedule' %}" class="text-decoration-none border-md-end pe-md-3 me-md-3 custom-link">My Schedule</a>
        <a href="{% url 'student_attendance_records' %}" class="text-decoration-none custom-link">Student Attendance Record</a>

      </div>

      <div class="d-flex align-items-center gap-2 gap-md-3">
        <button id="helpBtn" class="btn btn-outline-info btn-sm" type="button">Need Help?</button>
        <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm logout_btn">Logout</a>
      </div>
    </div>
  </div>
</div>

<!-- Help Guide Modal -->
<div class="modal fade" id="helpGuideModal" tabindex="-1" aria-labelledby="helpGuideLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content shadow">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title" id="helpGuideLabel">Help Guide</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body d-flex justify-content-center" id="helpSlide">
        <img id="helpImage" src="" alt="Help Guide Step" class="img-fluid rounded shadow" style="max-height: 75vh;" />
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button id="prevHelp" class="btn btn-secondary">Previous</button>
        <button id="nextHelp" class="btn btn-primary">Next</button>
      </div>
    </div>
  </div>
</div>

{% block help_images_script %}
<!-- Default help images - override in child templates -->
<script id="help-data" type="application/json">
{
    "steps": [
        "{% static 'image/Instructor-Schedule-1.PNG' %}",
        "{% static 'image/Instructor-Schedule-2.PNG' %}"
    ]
}
</script>
{% endblock %}

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const helpImage = document.getElementById("helpImage");
    const helpModal = document.getElementById("helpGuideModal");
    const prevBtn = document.getElementById("prevHelp");
    const nextBtn = document.getElementById("nextHelp");
    
    // Read help steps from JSON script tag
    let helpSteps = [];
    try {
      const helpDataScript = document.getElementById("help-data");
      if (helpDataScript) {
        const helpData = JSON.parse(helpDataScript.textContent);
        helpSteps = helpData.steps || [];
      }
    } catch (e) {
      console.error("Failed to load help images:", e);
      // Fallback to default images
      helpSteps = [
        "{% static 'image/Instructor-Schedule-1.PNG' %}",
        "{% static 'image/Instructor-Schedule-2.PNG' %}"
      ];
    }

    let currentStep = 0;
    let modalInstance = null;

    function updateImage() {
      if (helpSteps.length > 0) {
        helpImage.src = helpSteps[currentStep];
      }
      updateButtonStates();
    }

    function updateButtonStates() {
      // Disable and style Previous button if at first image
      if (currentStep === 0) {
        prevBtn.disabled = true;
        prevBtn.classList.remove('btn-secondary');
        prevBtn.classList.add('btn-light');
        prevBtn.style.opacity = '0.5';
        prevBtn.style.cursor = 'not-allowed';
      } else {
        prevBtn.disabled = false;
        prevBtn.classList.remove('btn-light');
        prevBtn.classList.add('btn-secondary');
        prevBtn.style.opacity = '1';
        prevBtn.style.cursor = 'pointer';
      }

      // Disable and style Next button if at last image
      if (currentStep === helpSteps.length - 1) {
        nextBtn.disabled = true;
        nextBtn.classList.remove('btn-primary');
        nextBtn.classList.add('btn-light');
        nextBtn.style.opacity = '0.5';
        nextBtn.style.cursor = 'not-allowed';
      } else {
        nextBtn.disabled = false;
        nextBtn.classList.remove('btn-light');
        nextBtn.classList.add('btn-primary');
        nextBtn.style.opacity = '1';
        nextBtn.style.cursor = 'pointer';
      }
    }

    // Create modal instance only once
    function getModalInstance() {
      if (!modalInstance) {
        modalInstance = new bootstrap.Modal(helpModal, {
          keyboard: true,
          backdrop: true
        });
      }
      return modalInstance;
    }

    // Clean up function to ensure backdrop is removed
    function cleanupModal() {
      const backdrops = document.querySelectorAll('.modal-backdrop');
      backdrops.forEach(backdrop => backdrop.remove());
      
      document.body.classList.remove('modal-open');
      document.body.style.overflow = '';
      document.body.style.paddingRight = '';
    }

    prevBtn.addEventListener("click", function () {
      if (currentStep > 0) {
        currentStep--;
        updateImage();
      }
    });

    nextBtn.addEventListener("click", function () {
      if (currentStep < helpSteps.length - 1) {
        currentStep++;
        updateImage();
      }
    });

    document.getElementById("helpBtn").addEventListener("click", function () {
      updateImage(); // Set initial image and button states before showing modal
      const modal = getModalInstance();
      modal.show();
    });

    // Add event listeners for modal close events
    helpModal.addEventListener('hidden.bs.modal', function () {
      cleanupModal();
      currentStep = 0;
      updateImage();
    });

    helpModal.addEventListener('hide.bs.modal', function () {
      setTimeout(cleanupModal, 100);
    });

    // Force cleanup on ESC key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape' && helpModal.classList.contains('show')) {
        cleanupModal();
      }
    });
  });
</script>

<main>
    {% block content %}{% endblock %}
</main>

<!-- Footer section -->
<footer class="footer bg-dark text-light py-5">
  <div class="container">
    <div class="row">
      <div class="col-md-4 mb-4">
        <h4>About Us</h4>
        <p>
            Our system provides accurate attendance monitoring, which uses fingerprint-based authentication, and allows easy generation of hardcopy attendance records.
        </p>
      </div>

      <div class="col-md-4 mb-4">
        <h4>Contact Us</h4>
        <p><i class="fa fa-map-marker-alt"></i> Address: CQT Avenue, Salawag, Dasmari√±as City, Cavite</p>
        <p><i class="fa fa-phone"></i> Mobile Number: +63 919 616 1221 </p>
        <p><i class="fa fa-envelope"></i> Email: tupcptlt@gmail.com</p>
      </div>
    </div>
  </div>
  <div class="footer-bottom text-center mt-4">
    <p>&copy; 2025 PTLT | All Rights Reserved</p>
  </div>
  
  <!-- Logout confirmation modal -->
  <div class="modal fade" id="confirmLogoutModal" tabindex="-1" aria-labelledby="confirmLogoutLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmLogoutLabel" style="color: #a74545;">Confirm Logout</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center text-dark">
          <i class="fa fa-exclamation-triangle fa-3x text-warning mb-3"></i>
          <h5 class="fw-bold">Are you sure you want to logout?</h5>
          <p class="text-muted">You will be redirected to the login page.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="confirmLogoutBtn" class="btn btn-danger">Yes, Logout</button>
        </div>
      </div>
    </div>
  </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const modalEl = document.getElementById('confirmLogoutModal');
  if (!modalEl) return;

  const bsModal = new bootstrap.Modal(modalEl, { keyboard: true, backdrop: 'static' });
  let logoutHref = null;

  document.querySelectorAll('.logout_btn').forEach(btn => {
    btn.addEventListener('click', function (e) {
      e.preventDefault();
      logoutHref = btn.getAttribute('href');
      bsModal.show();
    });
  });

  const confirmBtn = modalEl.querySelector('#confirmLogoutBtn');
  confirmBtn.addEventListener('click', function () {
    if (logoutHref) {
      window.location.assign(logoutHref);
    } else {
      bsModal.hide();
    }
  });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
